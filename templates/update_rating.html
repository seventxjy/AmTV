<!-- templates/update_rating.html -->
{% extends "base.html" %}

{% block title %}修改评分 - {{ rating.anime.name }}{% endblock %}

{% block content %}
<div class="max-w-md mx-auto">
    <div class="bg-white rounded-xl shadow-md p-6">
        <h2 class="text-xl font-bold text-gray-900 mb-6">修改对《{{ rating.anime.name }}》的评分</h2>

        <form id="ratingForm" method="POST" action="{{ url_for('update_rating', rating_id=rating.id) }}">
            <div class="space-y-4">
                <!-- 作画评分 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">作画</label>
                    <div class="flex items-center space-x-2">
                        {% for i in range(1, 6) %}
                            <label class="cursor-pointer flex-1 text-center">
                                <input type="radio" name="animation" value="{{ i }}" class="hidden peer"
                                    {% if rating.animation == i %}checked{% endif %} required>
                                <div class="border-2 rounded-md p-3 peer-checked:border-primary peer-checked:bg-primary/10 transition-colors">
                                    {{ i }}分
                                </div>
                            </label>
                        {% endfor %}
                    </div>
                </div>

                <!-- 演出评分 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">演出</label>
                    <div class="flex items-center space-x-2">
                        {% for i in range(1, 6) %}
                            <label class="cursor-pointer flex-1 text-center">
                                <input type="radio" name="direction" value="{{ i }}" class="hidden peer"
                                    {% if rating.direction == i %}checked{% endif %} required>
                                <div class="border-2 rounded-md p-3 peer-checked:border-primary peer-checked:bg-primary/10 transition-colors">
                                    {{ i }}分
                                </div>
                            </label>
                        {% endfor %}
                    </div>
                </div>

                <!-- 配音评分 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">配音</label>
                    <div class="flex items-center space-x-2">
                        {% for i in range(1, 6) %}
                            <label class="cursor-pointer flex-1 text-center">
                                <input type="radio" name="voice_acting" value="{{ i }}" class="hidden peer"
                                    {% if rating.voice_acting == i %}checked{% endif %} required>
                                <div class="border-2 rounded-md p-3 peer-checked:border-primary peer-checked:bg-primary/10 transition-colors">
                                    {{ i }}分
                                </div>
                            </label>
                        {% endfor %}
                    </div>
                </div>

                <!-- 音乐评分 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">音乐</label>
                    <div class="flex items-center space-x-2">
                        {% for i in range(1, 6) %}
                            <label class="cursor-pointer flex-1 text-center">
                                <input type="radio" name="music" value="{{ i }}" class="hidden peer"
                                    {% if rating.music == i %}checked{% endif %} required>
                                <div class="border-2 rounded-md p-3 peer-checked:border-primary peer-checked:bg-primary/10 transition-colors">
                                    {{ i }}分
                                </div>
                            </label>
                        {% endfor %}
                    </div>
                </div>

                <!-- 剧情评分 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">剧情</label>
                    <div class="flex items-center space-x-2">
                        {% for i in range(1, 6) %}
                            <label class="cursor-pointer flex-1 text-center">
                                <input type="radio" name="story" value="{{ i }}" class="hidden peer"
                                    {% if rating.story == i %}checked{% endif %} required>
                                <div class="border-2 rounded-md p-3 peer-checked:border-primary peer-checked:bg-primary/10 transition-colors">
                                    {{ i }}分
                                </div>
                            </label>
                        {% endfor %}
                    </div>
                </div>

                <!-- 总分预览 -->
                <div class="bg-gray-50 p-3 rounded-md">
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-medium text-gray-700">预计总分</span>
                        <span class="text-lg font-bold text-primary" id="totalScore">
                            {{ (0.4*rating.direction + 0.2*rating.animation + 0.2*rating.story + 0.1*rating.music + 0.1*rating.voice_acting)|round(1) }}
                        </span>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">计算公式: 0.4×演出 + 0.2×作画 + 0.2×剧情 + 0.1×音乐 + 0.1×配音</p>
                </div>

                <button type="submit" class="w-full bg-primary text-white px-4 py-2 rounded-md hover:bg-primary/90 transition-colors">
                    <i class="fa fa-check mr-1"></i> 保存修改
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const ratingForm = document.getElementById('ratingForm');
        const radioInputs = ratingForm.querySelectorAll('input[type="radio"]');

        // 计算总分
        function calculateTotalScore() {
            const animation = parseInt(document.querySelector('input[name="animation"]:checked')?.value || 0);
            const direction = parseInt(document.querySelector('input[name="direction"]:checked')?.value || 0);
            const voiceActing = parseInt(document.querySelector('input[name="voice_acting"]:checked')?.value || 0);
            const music = parseInt(document.querySelector('input[name="music"]:checked')?.value || 0);
            const story = parseInt(document.querySelector('input[name="story"]:checked')?.value || 0);

            // 加权计算
            const total = (0.4 * direction) + (0.2 * animation) + (0.2 * story) + (0.1 * music) + (0.1 * voiceActing);
            document.getElementById('totalScore').textContent = total.toFixed(1);
        }

        // 监听评分变化，实时计算总分
        radioInputs.forEach(input => {
            input.addEventListener('change', calculateTotalScore);
        });
    });
</script>
{% endblock %}